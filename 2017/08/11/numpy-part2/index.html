<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="ansvver's tech blog"><title>Numpy基本用法2 | ansvverのd機關</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Numpy基本用法2</h1><a id="logo" href="/.">ansvverのd機關</a><p class="description">思考 記錄 重溫 理解</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Numpy基本用法2</h1><div class="post-meta">Aug 11, 2017<span> | </span><span class="category"><a href="/categories/程序设计/">程序设计</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h3 id="循环计算效率"><a href="#循环计算效率" class="headerlink" title="循环计算效率"></a>循环计算效率</h3><p>Python（原生CPython）是一门动态解释性语言，由于其语言特性（可变类型），使得Python在进行数据运算时非常慢，运算序列不能编译成高效的机器码。</p>
<p>也由此衍生出许多解决的方案，如：Just-in-time  compiler版的<a href="http://pypy.org/" target="_blank" rel="noopener">Pypy</a>，把Python代码转化C的<a href="http://cython.org/" target="_blank" rel="noopener">Cython</a>，把Python代码转化为LLVM字节码的<a href="http://numba.pydata.org/" target="_blank" rel="noopener">Numba</a>，每种方案都各有优缺点，但目前这三种方案都没有像标准的CPython内核那么普及。</p>
<p>假设我们想求一个大数组中每个无素的倒数，用<code>for</code>原生实现如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_reciprocals</span><span class="params">(values)</span>:</span></span><br><span class="line">    output = np.empty(len(values))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(values)):</span><br><span class="line">        output[i] = <span class="number">1.0</span> / values[i]</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="comment"># values = np.random.randint(1, 10, size=5)</span></span><br><span class="line"><span class="comment"># compute_reciprocals(values)</span></span><br><span class="line"></span><br><span class="line">big_array = np.random.randint(<span class="number">1</span>, <span class="number">100</span>, size=<span class="number">1000000</span>)</span><br><span class="line">%timeit compute_reciprocals(big_array)</span><br><span class="line"><span class="comment"># 1 loop, best of 3: 374 ms per loop</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>机器配置不同，可能跑出的结果会不一样，但在同一台机器上跑实现同样功能的如下代码，对比还是十分明显的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%timeit (<span class="number">1.0</span> / big_array)</span><br><span class="line"><span class="comment"># 100 loops, best of 3: 4.6 ms per loop</span></span><br></pre></td></tr></table></figure>
<h3 id="常用通用函数"><a href="#常用通用函数" class="headerlink" title="常用通用函数"></a>常用通用函数</h3><p>Numpy中的向量化操作是通过通用函数实现的，它能有效地执行Numpy数列中的重复计算操作。同时，它的使用方法也是十分灵活多变的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">x = np.arange(<span class="number">4</span>)</span><br><span class="line">print(<span class="string">"x ="</span>, x)</span><br><span class="line">print(<span class="string">"x + 5 ="</span>, x + <span class="number">5</span>)</span><br><span class="line">print(<span class="string">"x - 5 ="</span>, x - <span class="number">5</span>)</span><br><span class="line">print(<span class="string">"x * 2 ="</span>, x * <span class="number">2</span>)</span><br><span class="line">print(<span class="string">"x / 2 ="</span>, x / <span class="number">2</span>)</span><br><span class="line">print(<span class="string">"x // 2 ="</span>, x // <span class="number">2</span>) <span class="comment"># floor division</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">x = [0 1 2 3]</span></span><br><span class="line"><span class="string">x + 5 = [5 6 7 8]</span></span><br><span class="line"><span class="string">x - 5 = [-5 -4 -3 -2]</span></span><br><span class="line"><span class="string">x * 2 = [0 2 4 6]</span></span><br><span class="line"><span class="string">x / 2 = [ 0. 0.5 1. 1.5]</span></span><br><span class="line"><span class="string">x // 2 = [0 0 1 1]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">"-x = "</span>, -x)</span><br><span class="line">print(<span class="string">"x ** 2 = "</span>, x ** <span class="number">2</span>)</span><br><span class="line">print(<span class="string">"x % 2 = "</span>, x % <span class="number">2</span>)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">-x = [ 0 -1 -2 -3]</span></span><br><span class="line"><span class="string">x ** 2 = [0 1 4 9]</span></span><br><span class="line"><span class="string">x % 2 = [0 1 0 1]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># +    np.add</span></span><br><span class="line"><span class="comment"># -    np.subtract</span></span><br><span class="line"><span class="comment"># -    np.negative</span></span><br><span class="line"><span class="comment"># *    np.multiply </span></span><br><span class="line"><span class="comment"># /    np.divide   </span></span><br><span class="line"><span class="comment"># //    np.floor_divide    </span></span><br><span class="line"><span class="comment"># **    np.power   </span></span><br><span class="line"><span class="comment"># %    np.mod    </span></span><br><span class="line"><span class="comment"># | |    np.abs</span></span><br><span class="line"><span class="comment"># cos    np.cos</span></span><br><span class="line"><span class="comment"># e^x    np.exp(x)</span></span><br><span class="line"><span class="comment"># 2^x    np.exp2(x)</span></span><br><span class="line"><span class="comment"># 3^x    np.power(3, x)</span></span><br><span class="line"><span class="comment"># ln    np.log(x)</span></span><br><span class="line"><span class="comment"># log2    np.log2(x)</span></span><br><span class="line"><span class="comment"># log10    np.log10(x)</span></span><br><span class="line"><span class="comment"># min    np.min / np.nanmin (NaN-safe Version)</span></span><br><span class="line"><span class="comment"># max    np.max / np.nanmax (NaN-safe Version)</span></span><br><span class="line"><span class="comment"># sum    np.sum / np.nansum (NaN-safe Version)</span></span><br><span class="line"><span class="comment"># any    np.any</span></span><br><span class="line"><span class="comment"># all    np.all</span></span><br><span class="line">np.add(x, <span class="number">2</span>)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">array([2, 3, 4, 5])</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">5</span>)</span><br><span class="line">y = np.empty(<span class="number">5</span>)</span><br><span class="line">np.multiply(x, <span class="number">10</span>, out=y)</span><br><span class="line">print(y)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[ 0. 10. 20. 30. 40.]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">y = np.zeros(<span class="number">10</span>)</span><br><span class="line">np.power(<span class="number">2</span>, x, out=y[::<span class="number">2</span>])</span><br><span class="line">print(y)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">[ 1. 0. 2. 0. 4. 0. 8. 0. 16. 0.]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<h3 id="聚合（Aggregates-以及专业函数"><a href="#聚合（Aggregates-以及专业函数" class="headerlink" title="聚合（Aggregates) 以及专业函数"></a>聚合（Aggregates) 以及专业函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Aggregates</span></span><br><span class="line">x = np.arange(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line">np.add.reduce(x) <span class="comment"># 15</span></span><br><span class="line">np.multiply.reduce(x) <span class="comment"># 120</span></span><br><span class="line">np.add.accumulate(x) <span class="comment"># array([ 1, 3, 6, 10, 15])</span></span><br><span class="line">np.multiply.accumulate(x) <span class="comment"># array([ 1, 2, 6, 24, 120])</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> special</span><br><span class="line"><span class="comment"># https://docs.scipy.org/doc/scipy-0.14.0/reference/special.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Gamma functions (generalized factorials) and related functions</span></span><br><span class="line">x = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>]</span><br><span class="line">print(<span class="string">"gamma(x) ="</span>, special.gamma(x))</span><br><span class="line">print(<span class="string">"ln|gamma(x)| ="</span>, special.gammaln(x))</span><br><span class="line">print(<span class="string">"beta(x, 2) ="</span>, special.beta(x, <span class="number">2</span>))</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">gamma(x) = [ 1.00000000e+00 2.40000000e+01 3.62880000e+05]</span></span><br><span class="line"><span class="string">ln|gamma(x)| = [ 0. 3.17805383 12.80182748]</span></span><br><span class="line"><span class="string">beta(x, 2) = [ 0.5 0.03333333 0.00909091]</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Error function (integral of Gaussian)</span></span><br><span class="line"><span class="comment"># its complement, and its inverse</span></span><br><span class="line">x = np.array([<span class="number">0</span>, <span class="number">0.3</span>, <span class="number">0.7</span>, <span class="number">1.0</span>])</span><br><span class="line">print(<span class="string">"erf(x) ="</span>, special.erf(x))</span><br><span class="line">print(<span class="string">"erfc(x) ="</span>, special.erfc(x))</span><br><span class="line">print(<span class="string">"erfinv(x) ="</span>, special.erfinv(x))</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">erf(x) = [ 0. 0.32862676 0.67780119 0.84270079]</span></span><br><span class="line"><span class="string">erfc(x) = [ 1. 0.67137324 0.32219881 0.15729921]</span></span><br><span class="line"><span class="string">erfinv(x) = [ 0. 0.27246271 0.73286908 inf]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<h3 id="Broadcasting"><a href="#Broadcasting" class="headerlink" title="Broadcasting"></a>Broadcasting</h3><p><img src="http://yabuhoo.qiniudn.com/static/img/201708/02.05-broadcasting.png" alt=""></p>
<ul>
<li>Rule 1: If the two arrays differ in their number of dimensions, the shape of the one with fewer dimensions is padded with ones on its leading (left) side.</li>
<li>Rule 2: If the shape of the two arrays does not match in any dimension, the array with shape equal to 1 in that dimension is stretched to match the other shape.</li>
<li>Rule 3: If in any dimension the sizes disagree and neither is equal to 1, an error is raised.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">3</span>).reshape((<span class="number">3</span>, <span class="number">1</span>))</span><br><span class="line">b = np.arange(<span class="number">3</span>)</span><br><span class="line">a + b</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">array([[0, 1, 2],</span></span><br><span class="line"><span class="string">       [1, 2, 3],</span></span><br><span class="line"><span class="string">       [2, 3, 4]])</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a.shape = (3, 1)    -&gt; (3, 1)    -&gt; (3, 3)</span></span><br><span class="line"><span class="comment"># b.shape = (3,)    -&gt; (1, 3)    -&gt; (3, 3)</span></span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a class="pre" href="/2017/08/18/numpy-part3/">Numpy基本用法3</a><a class="next" href="/2017/08/09/numpy-part1/">Numpy基本用法1</a></div><div id="container"></div><link rel="stylesheet" href="/css/default.css?v=0.0.0"><script src="/js/gitment.browser.js?v=0.0.0"></script><script>var gitment = new Gitment({
  owner: 'ansvver',
  repo: 'ansvver.github.io',
  oauth: {
    client_id: 'd83ac015fb516c998b72',
    client_secret: 'd18e99d572502728f4509ae4ddd16db173b39a3d',
  },
})
gitment.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/程序设计/">程序设计</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法实践/">算法实践</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/递归/" style="font-size: 15px;">递归</a> <a href="/tags/TensorFlow/" style="font-size: 15px;">TensorFlow</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/tensorflow-basic/">tensorflow基础概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/04/matplot_examples/">matplotlib示例</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/28/pandas-code/">Pandas code</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/numpy-part3/">Numpy基本用法3</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/11/numpy-part2/">Numpy基本用法2</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/09/numpy-part1/">Numpy基本用法1</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/09/ipython-note/">IPython基本用法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/19/incremental-update-dict-in-pymongo/">增量更新MongoDB字典数据</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">ansvverのd機關.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = '//hm.baidu.com/hm.js?' + '1848a65ec59a9c0e6bf99f245cb5b204';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>